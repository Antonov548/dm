---
title: "Visualizing 'dm' objects"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualizing 'dm' objects}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
fansi::set_knit_hooks(knitr::knit_hooks)
options(crayon.enabled = TRUE, width = 75, cli.width = 75)

knit_print.grViz <- function(x, ...) {
  x %>% 
    DiagrammeRsvg::export_svg() %>% 
    c("`````{=html}\n", ., "\n`````\n") %>% 
    knitr::asis_output()
}
```


Relevant functions for visualising the `dm` object's data model:^[The functions in this section rely heavily on related functions of {datamodelr}.]

1. `cdm_set_colors()`
1. `cdm_get_colors()`
1. `cdm_get_available_colors()`
1. `cdm_draw()`

Once you have all primary keys set and all foreign key relations defined, it might be interesting to look at a graphical representation of your data model.

We can just take here the prepared example `dm` object `cdm_nycflights13()`:
```{r}
library(dm)
flights_dm_w_many_keys <- cdm_nycflights13(color = FALSE)
flights_dm_w_many_keys
```

You can use colors to visually group your tables into families (which could reflect their logical grouping).
Currently, there are only eight different colors available (plus the option of having borders displayed around the tables or not).
To find out which colors exist, use `cdm_get_available_colors()`:
```{r}
cdm_get_available_colors()
```

The assignment is carried out with `cdm_set_colors()`, using a syntax similar to `switch()`.
Any table you don't specifically assign will be displayed in the default color. 
The result of `cdm_set_colors()` is a `dm` object.
The information about the color is stored in its `data_model`-part.
```{r}
flights_dm_w_many_keys_and_colors <-
  flights_dm_w_many_keys %>% 
  cdm_set_colors(
    flights = "blue",
    airlines = ,
    airports = "orange",
    planes = "green_nb"
  )
```

Draw the schema with `cdm_draw()`. 
```{r}
cdm_draw(flights_dm_w_many_keys_and_colors)
```

The colors can be queried with `cdm_get_colors()`. 
```{r}
cdm_get_colors(flights_dm_w_many_keys_and_colors)
```

There are quite a few options for customization available. 
Please read the documentation to find out more.
One argument of the function we'd like to draw your attention to, though, is `table_names`.
This argument accepts a character vector with the table names which are to be printed, in case you would like to only see a subset of the whole data model.
```{r}
cdm_draw(flights_dm_w_many_keys_and_colors, table_names = c("flights", "airports", "planes"))
```
