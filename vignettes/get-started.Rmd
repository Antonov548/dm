---
title: "Getting Started"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of both the package {dm} and the class `dm` - which comes along with it - is to facilitate your life when you are dealing with data that comes in a data model schema.
An object of the `dm`-class contains all relevant information about the tables in a data model:

1. the place where the tables live (i.e., the `src`: a database (DB) or locally in your R session)
2. the tables themselves, i.e., the data
3. the meta-data from the data model: the key relations

The 3rd point is implemented using the `data_model`-class from the package [{datamodelr}](https://github.com/bergant/datamodelr)^[Use: `devtools::install_github("https://github.com/bergant/datamodelr")` to install it].

The functions of {dm} are designed to work both locally and on DBs. 
It is possible to transfer `dm`-objects from one `src` to another and furthermore, you can even "learn" a `dm`-object from a DB, including the key relations.

Let's first have a brief look at how to create a `dm`-class object:

## Creating `dm`-objects:

A quite nice example for interconnected tables are those in the {nycflights13}-package.
The most straightforward way of squeezing them into a `dm`-object is:

```{r message=FALSE}
library(dm)
library(dplyr)
flights_dm <- dm(src_df(pkg = "nycflights13"))
flights_dm
```

Alternative ways of creating `dm`-objects are the functions `new_dm()` and `as_dm()`.
See their documentation for instructions how to use them.

It is important to mention, that we tried following the `tidyverse`-approach of immutable objects.
This means, that there are no functions, that will overwrite `dm`-objects.
Each verb, used on a `dm`-object, produces a new `dm`-object.

## Handling keys of `dm`-objects {#kr}

As you can see in the print-output above, so far no keys are set in the `data_model`-part of the `dm`.
This can be done in a -- hopefully -- rather intuitive way:

```{r}
cdm_add_pk(flights_dm, airports, faa)
```

The foreign key (fk) relations are established in a similar way (see documentation of `cdm_add_fk()` for details) to the setting of the primary keys (pk).

The following function provides a shortcut for the creation of a `dm`-object containing the {nycflights13}-tables with all primary keys (pk) and foreign key (fk) relations set:

```{r}
flights_dm_with_keys <- 
  cdm_nycflights13()
```

Further functions that are helpful in organizing the keys of a `dm`-object are able to e.g. show you, which columns are set as key columns, remove key constraints, etc.
More details can be found in the documentation of the relevant functions.

## Visualizing the data model

Once you set the pk's and established fk relations, you can graphically represent your data model in the following way:

```{r}
flights_dm_with_keys  %>% 
  cdm_draw()
```

There are a few options of customizing the way, the data model is displayed, e.g. add different colors to subsets of the tables or arrange the tables in a different way.
You can find details about this in the documentation or in the vignette "Visualizing 'dm'-objects".

