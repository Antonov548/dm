---
output:
  github_document:
    html_preview: false
---

```{r setup, include = FALSE}
library(tidyverse)
pkgload::load_all()

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

fansi::set_knit_hooks(knitr::knit_hooks)
options(crayon.enabled = TRUE, width = 75, cli.width = 75, pillar.bold = TRUE)

knit_print.grViz <- function(x, ...) {
  x %>%
    DiagrammeRsvg::export_svg() %>%
    c("`````{=html}\n", ., "\n`````\n") %>%
    knitr::asis_output()
}
```

<!-- badges: start -->
[![Lifecycle: maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![Travis build status](https://travis-ci.org/krlmlr/dm.svg?branch=master)](https://travis-ci.org/krlmlr/dm)
[![Codecov test coverage](https://codecov.io/gh/krlmlr/dm/branch/master/graph/badge.svg)](https://codecov.io/gh/krlmlr/dm?branch=master)
[![CRAN status](https://www.r-pkg.org/badges/version/dm)](https://CRAN.R-project.org/package=dm)
[![Launch rstudio.cloud](https://img.shields.io/badge/rstudio-cloud-blue.svg)](https://rstudio.cloud/project/523482)
<!-- badges: end -->

# dm

## Overview

FIXME: dm is a [grammar of joined tables](https://twitter.com/drob/status/1224851726068527106)?

dm is an R package for building and manipulating relational databases to aid the querying of data models stored in local dataframes, and the construction of flat data models from relational databases.

FIXME: Intro paragraph around three use cases for relational data models (=if you're working with more than one table/data frame in R)

1. use data (example below)

2. deploy data

3. organize data

END FIXME

The intent behind dm is to bridge the gap in the data pipeline between individual dataframes and relational databases by providing methods to move data between different sources, and methods for performing data manipulation (eg, aggregation, summarisation, filtering, etc) and table manipulation (eg, joins, creation, deletion, etc) that are agnostic to the data source.

FIXME: Immediate benefits of adopting dm, see "usage" for code

- very easy to bring an existing relational data model into your R session.
  We're using a built-in objects, it's easy with databases too.
  Interface and behavior modeled after dplyr.
  Little change to workflow -- behaves like a named list of tables

- benefit 1: visualization, understand relationships between entities represented by the tables

- benefit 2: simpler joins, "flatten" operation with column name disambiguation and automatic keys as an example

- benefit 3: consistency checks, understand (and fix!) limitations of your data

That's just the tip of the iceberg.
See "Getting started" to hit the ground running and explore all the features.

END FIXME

Calling methods on a dm object for importing data sources, defining relationships between them, and specifying the sequence of operations to produce the required data, results in clearly specified and repeatable workflows. 
dm's use of lazy evaluation minimises transfer and duplication of large datasets as you build your workflow, while providing snapshots of intermediate results for confirming your workflow is producing the expected results.

dm builds upon the [DBI](https://github.com/r-dbi/DBI) package for interfacing with over 30 DBMS's, [dplyr](https://dplyr.tidyverse.org/) for its database interaction methods and its grammar of data manipulation, and [tidyr](https://tidyr.tidyverse.org/) for its column operations. 

If you are new to dm, the best place to begin is the [Getting Started article](https://krlmlr.github.io/dm/articles/dm.html).

## Installation

The latest stable version of the {dm} package can be obtained from [CRAN](https://CRAN.R-project.org/package=dm) with the command

```r
install.packages("dm")
```

The latest development version of {dm} can be installed from GitHub.

```r
# install.packages("devtools")
devtools::install_github("krlmlr/dm")
```

## Usage

Load data as a dm object, see "Getting started" for details:

```{r}
library(dm)
dm <- dm_nycflights13()
dm
```

dm is a named list of tables:

```{r}
names(dm)
nrow(dm$airports)
dm$flights %>% 
  count(origin)
```

Visualize relationships at any time:

```{r draw}
dm %>%
  dm_draw()
```

Simple joins:

```{r}
dm %>% 
  dm_flatten_to_tbl(flights)
```

Check consistency:

```{r}
dm %>% 
  dm_examine_constraints()
```

That's just the tip of the iceberg.
See "Getting started" to hit the ground running and explore all the features.

END FIXME

## Getting help

If you encounter a clear bug, please file an issue with a minimal reproducible example on [GitHub](https://github.com/krlmlr/dm/issues).
For questions and other discussion, please use [community.rstudio.com](https://community.rstudio.com/).


---

License: MIT © cynkra GmbH.

Funded by:

[![energie360°](man/figures/energie-72.png)](https://www.energie360.ch)
<span style="padding-right:50px">
</span>
[![cynkra](man/figures/cynkra-72.png)](https://www.cynkra.com/)

---

Please note that the 'dm' project is released with a [Contributor Code of Conduct](https://krlmlr.github.io/dm/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.
